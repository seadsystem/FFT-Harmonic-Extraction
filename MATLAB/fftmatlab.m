Fs = 2400; %frequency sampling rate
t = 0:1/Fs:1-1/Fs; %correct x axis bins
%x = cos(2*pi*100*t)+randn(size(t)); %signal
%file fmt11.txt has the data
%everything before the start of fmt11.txt was noise (transition)
x = importdata('fridgedata.txt');
%x = [-3459,-3142,-2827,-3065,-2099,-1800,-1402,-1051,-1017,-369,-82,248,504,641,950,1144,1031,1528,1528,1437,1528,1400,1292,1174,980,812,632,376,337,-1017,-520,-776,-1191,-1544,-1954,-3065,-2568,-2824,-3321,-3650,-3938,-4232,-4460,-4616,-4845,-5113,-5148,-5182,-5229,-5187,-5152,-5113,-5000,-4839,-5113,-4466,-4203,-3848,-3592,-3284,-2952,-2939,-3065,-2184,-1533,-1160,-847,-1017,-136,120,504,606,1016,1144,1031,1528,1424,1528,1410,1416,1400,1272,1144,888,760,393,190,-119,-1017,-648,-1060,-1439,-1805,-2209,-3065,-2817,-3201,-2929,-3720,-4132,-4345,-4613,-5113,-4947,-5113,-5204,-5212,-5210,-5256,-5161,-5113,-4925,-4741,-4531,-4292,-3976,-3743,-3451,-3129,-2799,-3065,-2093,-1701,-1529,-897,-632,-307,7,284,632,760,956,1133,1272,1528,1424,1528,1384,1358,1283,1031,992,800,632,321,120,-288,-1017,-904,-1288,-1577,-1928,-2311,-2696,-3084,-3336,-3720,-3976,-4273,-4488,-4698,-5113,-5000,-5163,-5155,-5211,-5212,-5158,-5113,-4935,-4833,-4616,-4360,-4150,-4224,-3586,-3208,-3065,-2440,-2215,-1864,-1499,-1134,-776,-1017,-131,117,504,760,888,1080,1528,1272,1528,1528,1528,1400,364,1219,1010,888,760,419,159,-120,-505,-776,-1529,-1475,-1800,-2184,-2630,-2900,-3208,-3576,-3853,-4157,-4360,-5113,-4744,-5004,-4530,-5185,-5207,-5265,-5233,-5132,-5113,-4616,-4672,-4601,-4232,-3824,-3720,-3364,-3065,-2696,-2312,-2020,-1544,-1288,-904,-520,-264,30,376,528,897,986,1146,1528,1528,1415,1528,1528,1388,1239,1272,972,766,505,248,-2,-264,-1017,-904,-1288,-1684,-2075,-2422,-3065,-3091,-3448,-3724,-3976,-4232,-4478,-4708,-4872,-5113,-5091,-5180,-5228,-5187,-5140,-5000,-4987,-4787,-4601,-4359,-4145,-3843,-3495,-3205,-2824,-3065,-2172,-1792,-1529,-1121,-716,-505,-107,617,504,760,907,1144,1240,1360,1528,1528,1372,1528,1400,1031,1144,888,636,504,248,-159,-516,-776,-1188,-1537,-1800,-2184,-2568,-3065,-3208,-3584,-3848,-4153,-4360,-5113,-4744,-5113,-5000,-5186,-5137,-5231,-5210,-5434,-5016,-4857,-4616,-4360,-4218,-3848,-3668,-3348,-3065,-2568,-2312,-1928,-1544,-1244,-904,-520,-101,243,317,632,888,1031,1159,1400,1384,1528,1555,1468,1400,1272,1144,946,1016,504,251,-8,-337,-1017,-1023,-1393,-1672,-2075,-2440,-2824,-3577,-3412,-3728,-3976,-4322,-4601,-4744,-4872,-5000,-5153,-5223,-5201,-5236,-5143,-5000,-4872,-5113,-4488,-4305,-4073,-3795,-3577,-3208,-3065,-2413,-1800,-1672,-1400,-904,-696,-505,-73,106,504,760,959,1144,1272,1528,1441,1438,1528,1409,1528,1189,1003,888,760,504,97,-229,-520,-710,-1160,-1544,-2028,-2297,-2568,-3065,-3323,-3592,-3848,-4185,-4488,-4717,-4857,-5000,-5113,-5175,-5236,-5209,-5235,-5103,-5000,-5113,-4616,-4360,-4223,-3848,-3699,-3333,-3196,-2568,-2296,-1800,-1416,-1216,-828,-1017,-136,103,499,632,1016,1144,1031,1287,1420,1528,1426,1528,1353,1528,1100,991,624,510,186,-116,-505,-648,-1017,-1405,-1780,-2140,-3065,-2809,-2260,-3577,-3817,-4113,-4360,-4611,-4872];


N = length(x);
xdft = fft(x);

% cuts fft in half
xdft = xdft(1:N/2+1);
xdftabs = abs(xdft);


psdx = (1/(Fs*N)).*abs(xdft).^2;
% psdx(2:end-1) = psdx(2:end-1);
freq = 0:Fs/length(x):Fs/2;
figure;
plot(x); grid on;
filter = zeros([1,512]);
for i = 1:20
    filter(i) = 2 * xdft(i);
end

filtered = real(ifft(filter));
smoothed = sgolayfilt(xdftabs, 3, 21);
figure;
%subplot(212);
%plot(sgolayfilt(xdftabs, 6, 21)); grid on;
filteredrms = 0;
for j = 1:512
    filteredrms = filteredrms + filtered(j)^2;
end

%filteredrms = sqrt(filteredrms/512)

%length(freq)

%subplot(211);
plot(xdftabs); grid on;

[pks,locs] = findpeaks(xdftabs,'THRESHOLD',1000);

%figure; % fft representing a signal
%time = (0:1:511);
%fx = abs(xdft(10))*sin(time/9)

%plot(time , fx); grid on;
%title('Periodogram Using FFT');
%xlabel('Frequency (Hz)'); ylabel('Power/Frequency (dB/Hz)');
